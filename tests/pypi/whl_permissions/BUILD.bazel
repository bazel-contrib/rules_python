load("//python:defs.bzl", "py_binary")
load("//python:py_test.bzl", "py_test")
load("//tests/support:support.bzl", "SUPPORTS_BZLMOD_UNIXY")

# Tool to generate test wheels with bad permissions
py_binary(
    name = "build_test_wheel",
    srcs = ["build_test_wheel.py"],
)

# Pre-built test wheel with files that have no read permissions.
# This wheel is created by build_test_wheel.py and checked into the repo.
# The files inside have mode 000 (no permissions), which tests that
# whl_extract.bzl correctly fixes permissions after extraction.
exports_files(["bad_perms_pkg-1.0-py3-none-any.whl"])

# Test that we can use a wheel with bad file permissions
py_test(
    name = "whl_permissions_test",
    srcs = ["whl_permissions_test.py"],
    target_compatible_with = SUPPORTS_BZLMOD_UNIXY,
    deps = [
        "@whl_perms_bad_perms_pkg//:pkg",
    ],
)
