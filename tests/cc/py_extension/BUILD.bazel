load("@rules_cc//cc:defs.bzl", "cc_library")
load("//python:py_test.bzl", "py_test")

# buildifier: disable=bzl-visibility
load("//python/cc:py_extension.bzl", "py_extension")
load(":py_extension_tests.bzl", "py_extension_analysis_test_suite")

package(
    default_testonly = True,
    default_visibility = ["//visibility:private"],
)

licenses(["notice"])

py_extension(
    name = "ext_static",
    srcs = ["ext_static.c"],
    static_deps = [":static_dep"],
)

py_extension(
    name = "ext_shared",
    srcs = ["ext_shared.c"],
    dynamic_deps = [":dyn_dep_a"],
)

cc_library(
    name = "static_dep",
    srcs = ["static_dep.c"],
    hdrs = ["static_dep.h"],
)

cc_library(
    name = "dyn_dep_a",
    srcs = ["dyn_dep_a.c"],
    hdrs = ["dyn_dep_a.h"],
    linkstatic = False,
)

py_test(
    name = "py_extension_test",
    srcs = ["py_extension_test.py"],
    deps = [
        ":ext_shared",
        "@dev_pip//pyelftools",
        "@rules_python//python/runfiles",
    ],
)

py_extension_analysis_test_suite(
    name = "py_extension_analysis_tests",
)
